
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Waste Navigation</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        #map {
            height: 100vh;
            width: 100vw;
        }
        
        .mobile-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .search-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }
        
        .search-input:focus {
            border-color: #4285f4;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }
        
        .menu-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
        }
        
        .mobile-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            flex: 1;
            padding: 15px;
            background: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
        
        .control-btn.primary {
            background: #4285f4;
            color: white;
        }
        
        .control-btn.success {
            background: #34a853;
            color: white;
        }
        
        .control-btn.danger {
            background: #ea4335;
            color: white;
        }
        
        .floating-btn {
            position: fixed;
            bottom: 120px;
            right: 20px;
            z-index: 1000;
            background: #4285f4;
            color: white;
            border: none;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s;
        }
        
        .floating-btn:active {
            transform: scale(0.9);
        }
        
        .route-panel {
            position: fixed;
            top: 80px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .route-panel.show {
            max-height: 200px;
        }
        
        .route-step {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .route-step:last-child {
            border-bottom: none;
        }
        
        .route-icon {
            width: 24px;
            margin-right: 12px;
            text-align: center;
        }
        
        @media (max-width: 480px) {
            .mobile-controls {
                flex-wrap: wrap;
            }
            
            .control-btn {
                min-width: calc(50% - 5px);
            }
        }
    </style>
</head>

<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="üîç T√¨m ƒë·ªãa ƒëi·ªÉm ho·∫∑c th√πng r√°c..." id="mobileSearch">
            <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        </div>
    </div>
    
    <!-- Map Container -->
    <div id="map"></div>
    
    <!-- My Location Button -->
    <button class="floating-btn" onclick="centerOnMyLocation()" title="V·ªã tr√≠ c·ªßa t√¥i">
        üìç
    </button>
    
    <!-- Route Panel -->
    <div class="route-panel" id="routePanel">
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
            <h4>üß≠ Ch·ªâ ƒë∆∞·ªùng</h4>
            <button onclick="hideRoutePanel()" style="background: none; border: none; font-size: 18px; cursor: pointer;">√ó</button>
        </div>
        <div id="routeSteps">
            <!-- Route steps will be inserted here -->
        </div>
    </div>
    
    <!-- Mobile Controls -->
    <div class="mobile-controls">
        <button class="control-btn success" onclick="findNearestBin()">
            üóëÔ∏è Th√πng g·∫ßn nh·∫•t
        </button>
        <button class="control-btn primary" onclick="startNavigation()">
            üß≠ B·∫Øt ƒë·∫ßu
        </button>
        <button class="control-btn danger" onclick="stopNavigation()">
            ‚èπÔ∏è D·ª´ng
        </button>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize map
        const map = L.map('map').setView([10.77, 106.68], 14);
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
        
        // Current location marker
        let currentLocationMarker = null;
        let destinationMarker = null;
        let routeLine = null;
        
        // Sample waste bins
        const wasteBins = [
            {id: 'BIN001', lat: 10.7712, lng: 106.6817, status: 'full'},
            {id: 'BIN002', lat: 10.7689, lng: 106.6798, status: 'normal'},
            {id: 'BIN003', lat: 10.7745, lng: 106.6856, status: 'nearly_full'},
        ];
        
        // Add waste bin markers
        wasteBins.forEach(bin => {
            let color = 'green';
            if (bin.status === 'full') color = 'red';
            else if (bin.status === 'nearly_full') color = 'orange';
            
            const marker = L.marker([bin.lat, bin.lng], {
                icon: L.divIcon({
                    html: `<div style="background-color: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">üóëÔ∏è</div>`,
                    className: 'waste-bin-marker',
                    iconSize: [24, 24]
                })
            }).addTo(map);
            
            marker.bindPopup(`
                <div style="min-width: 200px;">
                    <h4>üóëÔ∏è Th√πng r√°c #${bin.id}</h4>
                    <p><b>Tr·∫°ng th√°i:</b> ${bin.status}</p>
                    <button onclick="routeToBin(${bin.lat}, ${bin.lng})" style="background: #4285f4; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                        üß≠ Ch·ªâ ƒë∆∞·ªùng ƒë·∫øn ƒë√¢y
                    </button>
                </div>
            `);
        });
        
        // Add current location
        function addCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    if (currentLocationMarker) {
                        map.removeLayer(currentLocationMarker);
                    }
                    
                    currentLocationMarker = L.marker([lat, lng], {
                        icon: L.divIcon({
                            html: '<div style="background-color: #4285f4; width: 16px; height: 16px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.3);"></div>',
                            className: 'current-location-marker',
                            iconSize: [22, 22]
                        })
                    }).addTo(map);
                    
                    currentLocationMarker.bindPopup('üìç V·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·∫°n');
                });
            }
        }
        
        // Center on current location
        function centerOnMyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    map.setView([lat, lng], 16);
                    addCurrentLocation();
                });
            }
        }
        
        // Find nearest bin
        function findNearestBin() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    
                    let nearestBin = null;
                    let minDistance = Infinity;
                    
                    wasteBins.forEach(bin => {
                        const distance = Math.sqrt(
                            Math.pow(bin.lat - userLat, 2) + Math.pow(bin.lng - userLng, 2)
                        );
                        
                        if (distance < minDistance) {
                            minDistance = distance;
                            nearestBin = bin;
                        }
                    });
                    
                    if (nearestBin) {
                        routeToBin(nearestBin.lat, nearestBin.lng);
                    }
                });
            }
        }
        
        // Route to bin
        function routeToBin(lat, lng) {
            if (destinationMarker) {
                map.removeLayer(destinationMarker);
            }
            
            destinationMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    html: '<div style="background-color: #34a853; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">üèÅ</div>',
                    className: 'destination-marker',
                    iconSize: [24, 24]
                })
            }).addTo(map);
            
            showRoutePanel();
            
            // Simulate route drawing
            if (routeLine) {
                map.removeLayer(routeLine);
            }
            
            // Get current position and draw route
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const startLat = position.coords.latitude;
                    const startLng = position.coords.longitude;
                    
                    routeLine = L.polyline([
                        [startLat, startLng],
                        [(startLat + lat) / 2, (startLng + lng) / 2],
                        [lat, lng]
                    ], {
                        color: '#4285f4',
                        weight: 4,
                        opacity: 0.8
                    }).addTo(map);
                    
                    map.fitBounds(routeLine.getBounds(), {padding: [50, 50]});
                });
            }
        }
        
        function showRoutePanel() {
            const panel = document.getElementById('routePanel');
            const steps = document.getElementById('routeSteps');
            
            steps.innerHTML = `
                <div class="route-step">
                    <div class="route-icon">üö∂</div>
                    <div>
                        <div style="font-weight: 600;">B·∫Øt ƒë·∫ßu di chuy·ªÉn</div>
                        <div style="font-size: 12px; color: #666;">ƒêi th·∫≥ng 200m</div>
                    </div>
                </div>
                <div class="route-step">
                    <div class="route-icon">‚Ü©Ô∏è</div>
                    <div>
                        <div style="font-weight: 600;">R·∫Ω tr√°i</div>
                        <div style="font-size: 12px; color: #666;">R·∫Ω tr√°i v√† ƒëi 150m</div>
                    </div>
                </div>
                <div class="route-step">
                    <div class="route-icon">üèÅ</div>
                    <div>
                        <div style="font-weight: 600;">ƒê·∫øn n∆°i</div>
                        <div style="font-size: 12px; color: #666;">Th√πng r√°c ·ªü b√™n ph·∫£i</div>
                    </div>
                </div>
            `;
            
            panel.classList.add('show');
        }
        
        function hideRoutePanel() {
            document.getElementById('routePanel').classList.remove('show');
        }
        
        function startNavigation() {
            if (routeLine) {
                alert('üß≠ B·∫Øt ƒë·∫ßu ch·ªâ ƒë∆∞·ªùng! Th·ª±c hi·ªán theo h∆∞·ªõng d·∫´n tr√™n m√†n h√¨nh.');
                showRoutePanel();
            } else {
                alert('Vui l√≤ng ch·ªçn ƒëi·ªÉm ƒë·∫øn tr∆∞·ªõc!');
            }
        }
        
        function stopNavigation() {
            if (routeLine) {
                map.removeLayer(routeLine);
                routeLine = null;
            }
            
            if (destinationMarker) {
                map.removeLayer(destinationMarker);
                destinationMarker = null;
            }
            
            hideRoutePanel();
        }
        
        function toggleMenu() {
            alert('Menu: C√†i ƒë·∫∑t, L·ªãch s·ª≠, B√°o c√°o, Tr·ª£ gi√∫p');
        }
        
        // Search functionality
        document.getElementById('mobileSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const query = this.value.toLowerCase();
                
                // Simple search implementation
                const locations = {
                    'home': [10.77, 106.68],
                    'office': [10.775, 106.685],
                    'market': [10.765, 106.675]
                };
                
                for (let [name, coords] of Object.entries(locations)) {
                    if (name.includes(query) || query.includes(name)) {
                        map.setView(coords, 16);
                        return;
                    }
                }
                
                // Search for bin ID
                const bin = wasteBins.find(b => b.id.toLowerCase().includes(query));
                if (bin) {
                    map.setView([bin.lat, bin.lng], 16);
                    return;
                }
                
                alert('Kh√¥ng t√¨m th·∫•y: ' + query);
            }
        });
        
        // Initialize current location on load
        addCurrentLocation();
        
        // Handle map clicks
        map.on('click', function(e) {
            const lat = e.latlng.lat;
            const lng = e.latlng.lng;
            
            routeToBin(lat, lng);
        });
        
        // Prevent zoom on double tap (iOS Safari)
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
    